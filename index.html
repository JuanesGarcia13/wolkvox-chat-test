<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat Wolkvox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script type="text/javascript">
    // 1. FUNCIÓN DE LIMPIEZA PROFUNDA
    function nukeChatSession() {
        // Limpia LocalStorage y SessionStorage
        localStorage.clear();
        sessionStorage.clear();

        // Limpia TODAS las cookies posibles para este dominio
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i];
            var eqPos = cookie.indexOf("=");
            var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
            // Intenta borrar también en subdominios si existieran
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=" + window.location.hostname;
        }
    }

    // Ejecutar al cargar la página
    nukeChatSession();

    // 2. DETECTOR DE CIERRE (Vigilante de la "X")
    // Cada 2 segundos revisamos si el chat se cerró para limpiar de nuevo
    setInterval(function() {
        // Wolkvox suele usar un div o un iframe. 
        // Si el usuario da click en X, el estado interno cambia.
        // Forzamos limpieza en segundo plano constantemente para que la próxima 
        // vez que cargue (o refresque) no haya basura.
        nukeChatSession();
    }, 2000);
  </script>
</head>
<body>

<script type="text/javascript">
    // 3. CARGA DINÁMICA ANTI-CACHÉ
    // Agregamos un token aleatorio a la URL del script para que Edge no lo reconozca
    (function() {
        var script = document.createElement('script');
        script.id = "prodId";
        script.type = "text/javascript";
        // El parámetro &_ rándom obliga a Wolkvox a generar una sesión limpia
        script.src = "https://widget01.wolkvox.com/chat/?prodId=c3VtbWEtbWFjLWNhLjIzNjI=" + "&_=" + Math.random();
        script.async = true;
        document.body.appendChild(script);
    })();
</script>
</body>
</html>
