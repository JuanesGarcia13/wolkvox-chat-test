<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat Wolkvox - Fix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<script type="text/javascript">
  (function() {
    // 1. LIMPIEZA TOTAL INMEDIATA
    localStorage.clear();
    sessionStorage.clear();
    
    // Limpieza de cookies de tu host
    document.cookie.split(";").forEach(function(c) { 
      document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
    });

    console.log("Memoria limpia. Iniciando carga de script...");

    // 2. CARGA MANUAL DEL SCRIPT (Sin async para evitar que use caché vieja)
    var wolkvoxScript = document.createElement('script');
    wolkvoxScript.id = "prodId";
    wolkvoxScript.type = "text/javascript";
    
    // Agregamos un número aleatorio al final de la URL (?v=...) 
    // Esto obliga a Edge y Chrome a descargar el script de nuevo y no usar el de la sesión anterior
    var antiCache = new Date().getTime();
    wolkvoxScript.src = "https://widget01.wolkvox.com/chat/?prodId=c3VtbWEtbWFjLWNhLjIzNjI=&v=" + antiCache;
    
    // Insertamos el script en el cuerpo
    document.body.appendChild(wolkvoxScript);
  })();
</script>

<script type="text/javascript">
  // 3. MONITOR DE RESCATE
  // Si en 12 segundos el chat no ha cargado nada (pantalla blanca),
  // significa que la sesión del servidor sigue "pegada". Forzamos un refresh.
  setTimeout(function() {
    var iframeChat = document.querySelector('iframe');
    if (!iframeChat) {
       console.log("Detectada pantalla blanca persistente. Refrescando...");
       window.location.reload();
    }
  }, 12000);
</script>

</body>
</html>
